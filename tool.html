<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>日文面試通</title>

  <!-- Vue.js -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  
  <!-- Tailwind CSS with specific version -->
  <script src="https://cdn.tailwindcss.com?v=3.4.1"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      },
    }
  </script>
  
  <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VXKMN286TH"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-VXKMN286TH');
    </script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Meta tags -->
  <meta name="description" content="專業的日文面試準備平台">
  <script src="./config.js"></script>
</head>
<body>
  <div id="app">
    <div class="font-inter">
      <!-- 導覽列 -->
      <nav class="bg-gradient-to-r from-blue-600 to-indigo-700 p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
          <h1 class="text-white text-3xl font-bold font-inter cursor-pointer" 
              @click="currentPage = 'landing'">
            日文面試通
          </h1>
        </div>
      </nav>

      <!-- 主要內容 -->
      <template v-if="!isAuthReady">
        <div class="flex justify-center items-center h-screen bg-gray-100">
          <div class="text-center text-xl text-gray-600">
            載入中，請稍候...
          </div>
        </div>
      </template>
      <template v-else>
        <component 
          :is="getCurrentPage"
          @navigate="navigateToPage"
          :user-id="user?.uid"
          @booking-success="handleBookingSuccess"
          :show-success-message="showBookingSuccess"
        ></component>
      </template>
    </div>
  </div>

  <!-- 暫時註解 OpenAI 相關程式碼 -->
  <!--
  <script>
      const API_KEY = "YOUR-API-KEY";
      // ...existing OpenAI integration code...
  </script>
  -->

  <script>
    // 定義所有子元件
    const CollapsibleSection = {
      props: {
        title: String,
      },
      data() {
        return {
          isOpen: false
        }
      },
      methods: {
        toggleOpen() {
          this.isOpen = !this.isOpen;
        }
      },
      template: `
        <div class="mb-4 bg-gray-100 p-4 rounded-lg shadow-sm">
          <button
            class="flex justify-between items-center w-full text-left text-xl font-semibold text-blue-700"
            @click="toggleOpen"
          >
            {{ title }}
            <span>{{ isOpen ? '▲' : '▼' }}</span>
          </button>
          <div v-if="isOpen" class="mt-4 text-gray-800">
            <slot></slot>
          </div>
        </div>
      `
    };

    // 其他子元件定義...
    const SectionCard = {
      props: ['title', 'description', 'color'],
      template: `
        <div :class="['mb-8 bg-white rounded-xl shadow-md overflow-hidden border-l-8', color]">
          <div class="p-6">
            <h3 class="text-3xl font-bold text-gray-800 mb-3">{{ title }}</h3>
            <p class="text-gray-600 text-lg mb-4">{{ description }}</p>
            <div class="text-gray-700 text-base leading-relaxed">
              <slot></slot>
            </div>
          </div>
        </div>
      `
    };

    const FeatureCard = {
      props: ['icon', 'title', 'description'],
      emits: ['click'],
      template: `
        <div
          class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center text-center transition duration-300 transform hover:scale-105 hover:shadow-2xl cursor-pointer"
          @click="$emit('click')"
        >
          <div class="text-6xl mb-4">{{ icon }}</div>
          <h3 class="text-2xl font-bold text-gray-800 mb-2">{{ title }}</h3>
          <p class="text-gray-600 mb-4">{{ description }}</p>
          <button
            class="mt-auto px-6 py-2 rounded-full font-semibold bg-blue-500 text-white hover:bg-blue-600"
          >
            了解更多
          </button>
        </div>
      `
    };

    // 主要頁面元件
    const LandingPage = {
      components: { FeatureCard },
      emits: ['navigate'],
      methods: {
        navigate(pageName) {
          this.$emit('navigate', pageName);
        }
      },
      template: `
        <div class="min-h-screen bg-gray-50 py-12 flex flex-col items-center">
          <header class="text-center mb-12 px-4">
            <h2 class="text-5xl md:text-6xl font-extrabold text-blue-800 mb-4 tracking-tight">
              日文面試成功，從這裡開始！
            </h2>
            <p class="text-xl md:text-2xl text-gray-600 max-w-2xl mx-auto leading-relaxed">
              為您量身打造的日文面試準備平台，助您自信應對，職涯起飛。
            </p>
          </header>

          <div class="flex flex-col sm:flex-row space-y-6 sm:space-y-0 sm:space-x-6 mb-16">
            <button
              @click="navigate('interview-essentials')"
              class="bg-blue-600 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-xl hover:bg-blue-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300"
            >
              面試準備
            </button>
            <button
              @click="navigate('resume-review')"
              class="bg-indigo-600 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-xl hover:bg-indigo-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-300"
            >
              履歷審核
            </button>
            <a href="https://ctssjpit.com" target="_blank">
              <button
                class="bg-green-600 text-white px-10 py-5 rounded-full text-2xl font-bold shadow-xl hover:bg-green-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-green-300"
              >
                TO CTSS
              </button>
            </a>
           </div>

          <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 px-8 max-w-6xl mx-auto">
            <FeatureCard
              icon="📚"
              title="面試精華"
              description="涵蓋面試技巧、禮儀與策略，助您脫穎而出。"
              @click="() => navigate('interview-essentials')"
            />
            <FeatureCard
              icon="📝"
              title="用詞用具"
              description="專注日文敬語與商務詞彙，精準表達不失禮。"
              @click="() => navigate('vocabulary-usage')"
            />
            <FeatureCard
              icon="🤖"
              title="AI 履歷審核"
              description="模擬 AI 摘要履歷，快速掌握重點與亮點。"
              @click="() => navigate('resume-review')"
            />
            <FeatureCard
              icon="🤝"
              title="免費諮詢"
              description="預約一對一專業指導，個人化解決您的疑問。"
              @click="() => navigate('consultation')"
            />
          </section>
        </div>
      `
    };

    // 日文面試準備精華頁組件 (InterviewEssentialsPage)
    const InterviewEssentialsPage = {
      components: { SectionCard, CollapsibleSection },
      data() {
        return {
          mockAnswer: '',
          isAnalyzing: false,
          analysisResult: '',
          showAnalysisModal: false,
          sampleSelfIntro: `〇〇と申します。これまではソフトウェア開発の分野で、5年間、フロントエンドとバックエンドの両方で経験を積んでまいりました。特にReactとNode.jsを用いたWebアプリケーションの開発に強みがあります。御社の革新的なAI技術を活用したプロダクト開発に魅力を感じ、これまでの経験と技術を活かして貢献したいと考えております。`
        }
      },
      methods: {
        async checkAnswer() {
          if (!this.mockAnswer.trim()) {
            alert('請輸入您的回答進行模擬！');
            return;
          }

          this.isAnalyzing = true;
          try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${config.OPENAI_API_KEY}`
              },
              body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                  {
                    role: "system",
                    content: "你是一位專業的日文面試官，負責評估應試者的自我介紹。請從以下幾個方面評估：1. 語言使用的正確性 2. 敬語運用 3. 內容完整度 4. 表達的專業度。請用中文給出具體建議。"
                  },
                  {
                    role: "user",
                    content: `請評估以下日文自我介紹並給出改進建議：\n\n${this.mockAnswer}`
                  }
                ],
                temperature: 0.7,
                max_tokens: 500
              })
            });

            const result = await response.json();
            if (result.choices && result.choices[0]?.message?.content) {
              this.analysisResult = result.choices[0].message.content.trim();
              // 顯示分析結果
              this.$nextTick(() => {
                this.showAnalysisModal = true;
              });
            } else {
              throw new Error('AI response format error');
            }
          } catch (error) {
            console.error('分析失敗:', error);
            alert('分析失敗，請稍後再試。');
          } finally {
            this.isAnalyzing = false;
          }
        }
      },
      template: `
        <div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
          <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">日文面試準備精華</h2>

            <SectionCard
              title="常見面試問題與範例回答"
              description="掌握核心問題，準備萬無一失的回答。"
              color="border-l-blue-500"
            >
              <CollapsibleSection title="1. 自我介紹 (自己紹介)">
                <p class="mb-2">
                  範例：
                  <span class="italic text-gray-700">
                    「〇〇と申します。これまでは〇〇の分野で、〇〇の経験を積んでまいりました。貴社の〇〇という点に魅力を感じ、これまでの経験を活かして貢献したいと考えております。」
                  </span>
                </p>
                <p>
                  要點：簡潔明瞭，包含姓名、過往經驗、志望動機、如何貢獻。
                </p>
              </CollapsibleSection>
              <CollapsibleSection title="2. 志望動機 (志望動機)">
                <p class="mb-2">
                  範例：
                  <span class="italic text-gray-700">
                    「貴社の〇〇という事業展開に深く共感し、特に〇〇のプロジェクトに強い関心を持っております。私の〇〇のスキルが、貴社の目標達成に貢献できると確信しております。」
                  </span>
                </p>
                <p>
                  要點：表達對公司的理解與熱情，連結個人能力與公司需求。
                </p>
              </CollapsibleSection>
              <CollapsibleSection title="3. 強項與弱項 (長所と短所)">
                <p class="mb-2">
                  強項範例：<span class="italic text-gray-700">「私の長所は、問題解決能力が高い点です。〇〇プロジェクトで〇〇の課題に直面した際、〇〇なアプローチで解決し、〇〇の成果を上げました。」</span>
                </p>
                <p class="mb-2">
                  弱項範例：<span class="italic text-gray-700">「私の短所は、完璧主義な傾向がある点です。しかし、最近は計画段階で優先順位をつけ、効率的に進めることを意識することで改善しています。」</span>
                </p>
                <p>要點：強項要舉例，弱項要說明如何改進。</p>
              </CollapsibleSection>
            </SectionCard>

            <SectionCard
              title="模擬面試練習"
              description="輸入您的回答，進行 AI 評估。"
              color="border-l-orange-500"
            >
              <p class="text-lg font-medium mb-3">問題：請用日文進行自我介紹（約 1 分鐘）。</p>
              <textarea
                class="w-full p-3 border border-gray-300 rounded-lg h-32 focus:ring-blue-500 focus:border-blue-500 text-gray-800"
                placeholder="請在此輸入您的日文自我介紹..."
                v-model="mockAnswer"
              ></textarea>
              <button
                @click="checkAnswer"
                :disabled="isAnalyzing"
                class="mt-4 bg-green-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-105 flex items-center justify-center"
              >
                <template v-if="isAnalyzing">
                  <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                  AI 分析中...
                </template>
                <template v-else>
                  AI 模擬面試評估
                </template>
              </button>

              <!-- 分析結果彈窗 -->
              <div v-if="showAnalysisModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-xl p-6 max-w-lg w-full">
                  <h3 class="text-xl font-bold text-gray-800 mb-4">AI 評估結果</h3>
                  <div class="prose prose-blue max-w-none">
                    <p class="whitespace-pre-wrap text-gray-700">{{ analysisResult }}</p>
                  </div>
                  <button
                    @click="showAnalysisModal = false"
                    class="mt-6 w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"
                  >
                    關閉
                  </button>
                </div>
              </div>
            </SectionCard>

            <SectionCard
              title="面試禮儀與注意事項"
              description="細節決定成敗，展現您的專業度。"
              color="border-l-green-500"
            >
              <CollapsibleSection title="1. 服裝儀容">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>男士：深色西裝、白襯衫、素色領帶，整潔的髮型。</li>
                  <li>女士：深色套裝、內搭襯衫，避免過度妝容與飾品，髮型整齊。</li>
                </ul>
              </CollapsibleSection>
              <CollapsibleSection title="2. 問候語與入座時機">
                <p class="mb-2">
                  進入面試室時：<span class="italic text-gray-700">「失礼いたします。」</span>
                </p>
                <p>
                  就座前：等待面試官指示 <span class="italic text-gray-700">「どうぞおかけください」</span> 後再入座。
                </p>
              </CollapsibleSection>
              <CollapsibleSection title="3. 眼神交流與肢體語言">
                <p class="mb-2">
                  眼神：與面試官保持適度眼神交流，不必長時間直視。
                </p>
                <p>
                  肢體：坐姿端正，雙手可輕放在膝上，避免頻繁小動作。
                </p>
              </CollapsibleSection>
            </SectionCard>

            <SectionCard
              title="產業別面試重點"
              description="針對不同行業，提供專屬面試建議。"
              color="border-l-purple-500"
            >
              <CollapsibleSection title="1. IT 產業">
                <p class="mb-2">重點：技術能力、解決問題能力、團隊合作、對新技術的學習熱情。</p>
                <p>
                  常用詞彙：アジャイル (Agile)、クラウド (Cloud)、デプロイ (Deploy)、フレームワーク (Framework)。
                </p>
              </CollapsibleSection>
              <CollapsibleSection title="2. 貿易/商社">
                <p class="mb-2">重點：溝通能力、談判技巧、語學能力、國際視野、抗壓性。</p>
                <p>
                  常用詞彙：サプライチェーン (Supply Chain)、交渉 (Negotiation)、市場調査 (Market Research)。
                </p>
              </CollapsibleSection>
            </SectionCard>
          </div>
        </div>
      `
    };

    // 用詞用具準備頁組件 (VocabularyUsagePage)
    const VocabularyUsagePage = {
      components: { SectionCard, CollapsibleSection },
      data() {
        return {
          quizQuestions: [
            {
              question: "下列哪一個是「行く (去)」的尊敬語？",
              options: ["参る", "申す", "いらっしゃる", "ございます"],
              answer: "いらっしゃる"
            },
            {
              question: "當對方說「お世話になっております」時，最恰當的回應是？",
              options: ["どういたしまして", "こちらこそお世話になっております", "はい、そうです", "分かりました"],
              answer: "こちらこそお世話になっております"
            },
            {
              question: "「資料」的日文商務常用詞彙是什麼？",
              options: ["しりょう", "データ", "マニュアル", "ドキュメント"],
              answer: "しりょう"
            }
          ],
          currentQuestionIndex: 0,
          showQuizResult: false,
          correctAnswers: 0,
          selectedOption: ''
        }
      },
      methods: {
        handleOptionSelect(option) {
          this.selectedOption = option;
        },
        checkAnswer() {
          if (this.selectedOption === this.quizQuestions[this.currentQuestionIndex].answer) {
            this.correctAnswers++;
          }
          this.showQuizResult = true;
        },
        nextQuestion() {
          this.showQuizResult = false;
          this.selectedOption = '';
          if (this.currentQuestionIndex < this.quizQuestions.length - 1) {
            this.currentQuestionIndex++;
          } else {
            alert(`測驗結束！您答對了 ${this.correctAnswers} 題，共 ${this.quizQuestions.length} 題。`);
            this.currentQuestionIndex = 0; // 重設測驗
            this.correctAnswers = 0;
          }
        }
      },
      template: `
        <div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
          <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">用詞用具準備</h2>

            <SectionCard
              title="敬語用法精解"
              description="日文敬語是職場溝通的關鍵，正確使用展現您的專業。"
              color="border-l-red-500"
            >
              <CollapsibleSection title="1. 尊敬語 (そんけいご)">
                <p class="mb-2">
                  用於抬高對方（長輩、客戶、上司）的動作或狀態。
                  <br />
                  例：行く → いらっしゃる (去)；食べる → 召し上がる (吃)；言う → おっしゃる (說)
                </p>
                <p>要點：表示對對方的敬意，用於對方的行為。</p>
              </CollapsibleSection>
              <CollapsibleSection title="2. 謙讓語 (けんじょうご)">
                <p class="mb-2">
                  用於降低自己的動作，以示對對方的尊敬。
                  <br />
                  例：言う → 申す (說)；する → いたす (做)；行く → 参る (去)
                </p>
                <p>要點：表示對方的地位高於自己，用於自己的行為。</p>
              </CollapsibleSection>
              <CollapsibleSection title="3. 丁寧語 (ていねいご)">
                <p class="mb-2">
                  最基本的禮貌用語，以「です」「ます」結尾，對任何人都可以使用。
                  <br />
                  例：本を読む → 本を読みます (讀書)；嬉しい → 嬉しいです (開心)
                </p>
                <p>要點：使語氣更禮貌、客氣。</p>
              </CollapsibleSection>
              <CollapsibleSection title="敬語常見錯誤與避免">
                <p class="mb-2">
                  錯誤範例：<span class="italic text-red-600">「お客様が参られました。」</span> (客戶來了，錯誤使用謙讓語)
                  <br />
                  正確用法：<span class="italic text-green-600">「お客様がいらっしゃいました。」</span> (客戶來了，正確使用尊敬語)
                </p>
                <p>要點：區分清楚對象和行為的主體。</p>
              </CollapsibleSection>
            </SectionCard>

            <SectionCard
              title="詞彙測驗"
              description="測試您對日文商務詞彙和敬語的理解！"
              color="border-l-blue-400"
            >
              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4">問題 {{ currentQuestionIndex + 1 }}/{{ quizQuestions.length }}</h3>
                <p class="text-lg mb-4">{{ quizQuestions[currentQuestionIndex].question }}</p>
                <div class="space-y-3">
                  <button
                    v-for="(option, index) in quizQuestions[currentQuestionIndex].options"
                    :key="index"
                    @click="handleOptionSelect(option)"
                    :class="[
                      'w-full text-left p-3 rounded-lg border-2 transition duration-200',
                      selectedOption === option ? 'bg-blue-100 border-blue-500' : 'bg-gray-50 border-gray-200 hover:border-blue-300',
                      showQuizResult && option === quizQuestions[currentQuestionIndex].answer ? 'border-green-500 bg-green-50' : '',
                      showQuizResult && selectedOption === option && selectedOption !== quizQuestions[currentQuestionIndex].answer ? 'border-red-500 bg-red-50' : ''
                    ]"
                    :disabled="showQuizResult"
                  >
                    {{ option }}
                  </button>
                </div>
                <button
                  v-if="!showQuizResult"
                  @click="checkAnswer"
                  :disabled="!selectedOption"
                  class="mt-6 w-full bg-blue-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-blue-700 transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  檢查答案
                </button>
                <button
                  v-else
                  @click="nextQuestion"
                  class="mt-6 w-full bg-green-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-105"
                >
                  {{ currentQuestionIndex < quizQuestions.length - 1 ? '下一題' : '重新開始測驗' }}
                </button>
                <p v-if="showQuizResult" class="mt-4 text-center text-lg font-semibold">
                  <span v-if="selectedOption === quizQuestions[currentQuestionIndex].answer" class="text-green-700">正確！</span>
                  <span v-else class="text-red-700">錯誤。正確答案是：{{ quizQuestions[currentQuestionIndex].answer }}</span>
                </p>
              </div>
            </SectionCard>

            <SectionCard
              title="常用日文商務詞彙"
              description="熟悉商務用語，讓您溝通無礙。"
              color="border-l-yellow-500"
            >
              <CollapsibleSection title="辦公室用語">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>承知いたしました (かしこまりました): 我明白了/我知道了 (更禮貌)</li>
                  <li>恐れ入ります: 不好意思/很抱歉/謝謝 (表達謙遜或感謝)</li>
                  <li>お世話になっております: 承蒙關照 (常用於商務往來開頭)</li>
                  <li>お疲れ様です: 辛苦了 (用於同事間或上下班問候)</li>
                </ul>
              </CollapsibleSection>
              <CollapsibleSection title="會議與報告相關詞彙">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>議事録 (ぎじろく): 會議記錄</li>
                  <li>資料 (しりょう): 資料</li>
                  <li>ご意見 (ごいけん): 意見</li>
                  <li>検討 (けんとう): 討論/研討</li>
                  <li>提案 (ていあん): 提案</li>
                </ul>
              </CollapsibleSection>
            </SectionCard>

            <SectionCard
              title="面試常用句型"
              description="實用句型，讓您在面試中流暢表達。"
              color="border-l-indigo-500"
            >
              <CollapsibleSection title="表達興趣與熱情">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>「〜に興味があります。」(我對...很感興趣。)
                    <br />例：「貴社の企業文化に大変興味があります。」</li>
                  <li>「〜に魅力を感じました。」(我被...所吸引。)
                    <br />例：「御社のチームの協調性に魅力を感じました。」</li>
                </ul>
              </CollapsibleSection>
              <CollapsibleSection title="說明經驗與能力">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>「〜の経験があります。」(我有...的經驗。)
                    <br />例：「私はプロジェクト管理の経験があります。」</li>
                  <li>「〜が得意です。」(我擅長...)
                    <br />例：「私はデータ分析が得意です。」</li>
                </ul>
              </CollapsibleSection>
              <CollapsibleSection title="表達貢獻意願">
                <ul class="list-disc list-inside text-gray-700 mb-2">
                  <li>「〜に貢献したいと考えております。」(我希望能對...有所貢獻。)
                    <br />例：「私のスキルで貴社の成長に貢献したいと考えております。」</li>
                  <li>「〜で貴社に貢献できると確信しております。」(我確信能用...為貴公司貢獻。)
                    <br />例：「私の問題解決能力で貴社に貢献できると確信しております。」</li>
                </ul>
              </CollapsibleSection>
            </SectionCard>
          </div>
        </div>
      `
    };

    // 履歷審核與 AI 摘要頁組件 (ResumeReviewPage)
    const ResumeReviewPage = {
      props: {
        userId: String
      },
      components: { SectionCard, CollapsibleSection },
      data() {
        return {
          selectedFile: null,
          resumeContent: '',
          aiSummary: '',
          isLoading: false,
          interviewSettings: {
            industry: 'IT', // 預設產業
            role: 'general', // 預設面試官角色
            language: 'japanese', // 預設語言
            level: 'intermediate', // 預設難度
            focus: ['technical', 'communication'] // 評估重點
          },
          industries: [
            { value: 'IT', label: 'IT/軟體開發' },
            { value: 'trading', label: '貿易/商社' },
            { value: 'manufacturing', label: '製造業' },
            { value: 'service', label: '服務業' }
          ],
          roles: [
            { value: 'general', label: '一般面試官' },
            { value: 'hr', label: '人資主管' },
            { value: 'technical', label: '技術主管' },
            { value: 'department', label: '部門主管' }
          ],
          languages: [
            { value: 'japanese', label: '日文' },
            { value: 'english', label: '英文' },
            { value: 'chinese', label: '中文' }
          ],
          levels: [
            { value: 'beginner', label: '初級' },
            { value: 'intermediate', label: '中級' },
            { value: 'advanced', label: '高級' }
          ],
          interviewQuestions: [], // 存儲生成的面試問題
          currentQuestionIndex: 0,
          userAnswer: '',
          feedbackResult: ''
        }
      },
      methods: {
        async callOpenAI(agent, content, customPrompt = '') {
    try {
      const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${config.OPENAI_API_KEY}`
        },
        body: JSON.stringify({
          model: AI_CONFIG.model,
          messages: [
            {
              role: AI_CONFIG.agents[agent].role,
              content: customPrompt || AI_CONFIG.agents[agent].basePrompt(this.interviewSettings)
            },
            {
              role: "user",
              content: content
            }
          ],
          temperature: AI_CONFIG.temperature,
          max_tokens: AI_CONFIG.maxTokens,
          presence_penalty: AI_CONFIG.presencePenalty,
          frequency_penalty: AI_CONFIG.frequencyPenalty
        })
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error('API 調用失敗:', error);
      throw error;
    }
  },

        // 修改檔案上傳處理方法
        uploadFile() {
          // 創建隱藏的文件輸入元素
          const fileInput = document.createElement('input');
          fileInput.type = 'file';
          fileInput.accept = '.txt, .pdf';
          fileInput.style.display = 'none';
          
          fileInput.onchange = (event) => {
            const file = event.target.files[0];
            if (file) {
              this.selectedFile = file;
              this.aiSummary = '';

              const reader = new FileReader();
              reader.onload = (e) => {
                try {
                  const content = e.target.result;
                  if (!content || content.trim().length === 0) {
                    throw new Error('檔案內容為空');
                  }
                  if (content.length > 4000) { // OpenAI API 有字數限制
                    throw new Error('檔案內容過長');
                  }
                  this.resumeContent = content;
                } catch (error) {
                  console.error('檔案讀取失敗:', error);
                  alert('檔案讀取失敗：' + error.message);
                  this.resumeContent = '';
                }
              };
              reader.onerror = (error) => {
                console.error('檔案讀取錯誤:', error);
                alert('檔案讀取錯誤，請重試。');
              };
              reader.readAsText(file);
            }
          };

          // 觸發點擊
          fileInput.click();
        },

        // 模擬 AI 摘要
        async simulateAISummary() {
          if (!this.resumeContent) {
            alert('請先上傳履歷文件！');
            return;
          }

          this.isLoading = true;
          this.aiSummary = '';

          try {
            const result = await this.callOpenAI('resumeAnalyzer', this.resumeContent);
            if (result.choices && result.choices[0]?.message?.content) {
              const analysis = JSON.parse(result.choices[0].message.content);
              this.aiSummary = this.formatAnalysis(analysis);
            } else {
              throw new Error('無效的 API 響應格式');
            }
          } catch (error) {
            console.error('AI 分析失敗:', error);
            this.aiSummary = `分析過程發生錯誤：${error.message}`;
          } finally {
            this.isLoading = false;
          }
        },

        formatAnalysis(analysis) {
          return `
## 履歷分析報告

### 專業技能評估
${analysis.skills_evaluation}

### 經驗相關度
${analysis.experience_relevance}

### 個人特質分析
${analysis.personality_analysis}

### 職涯發展潛力
${analysis.career_potential}

### ${this.interviewSettings.industry}產業專屬建議
${analysis.industry_specific_advice}

### 改進建議
${analysis.improvement_suggestions}
      `;
        },

        // 生成面試問題
        async generateInterviewQuestions() {
          this.isLoading = true;
          try {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${config.OPENAI_API_KEY}`
              },
              body: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [
                  {
                    role: "system",
                    content: `你是一位${this.interviewSettings.industry}產業面試官。
                請生成5個面試問題，每個問題包含：
                1. 問題內容
                2. 建議回答要點
                3. 評分標準
                
                請直接返回JSON陣列格式，不要加入其他描述文字。
                格式如下：
                [
                  {
                    "question": "問題內容",
                    "suggestedAnswer": "建議回答要點",
                    "evaluationCriteria": "評分標準"
                  }
                ]`
                  },
                  {
                    role: "user",
                    content: "請根據以上要求生成面試問題"
                  }
                ],
                temperature: 0.7
              })
            });

            const result = await response.json();
            
            // 清理並解析 JSON
            let content = result.choices[0].message.content;
            
            // 移除可能的 Markdown 標記
            content = content.replace(/```json\n?/g, '').replace(/```\n?/g, '');
            
            // 確保內容是有效的 JSON 字串
            content = content.trim();
            
            try {
              const questions = JSON.parse(content);
              this.interviewQuestions = questions;
              this.currentQuestionIndex = 0;
            } catch (parseError) {
              console.error('JSON 解析失敗:', parseError);
              console.log('原始內容:', content);
              throw new Error('面試問題格式無效');
            }

          } catch (error) {
            console.error('生成問題失敗:', error);
            console.log('API 響應:', result);
            console.log('清理後的內容:', content);
            alert('生成面試問題時發生錯誤，請稍後再試');
          } finally {
            this.isLoading = false;
          }
        },

        // 評估回答
        async evaluateAnswer() {
          if (!this.userAnswer) {
            alert('請先輸入您的回答！');
            return;
          }

          this.isAnalyzing = true;
          try {
            const result = await this.callOpenAI('interviewer', 
              `問題：${this.interviewQuestions[this.currentQuestionIndex].question}\n回答：${this.userAnswer}`
            );
            this.feedbackResult = result.choices[0].message.content;
          } catch (error) {
            console.error('評估失敗:', error);
            this.feedbackResult = '評估過程發生錯誤，請稍後再試。';
          } finally {
            this.isAnalyzing = false;
          }
        }
      },
      template: `
        <div class="min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8">
          <div class="max-w-4xl mx-auto bg-white p-8 rounded-xl shadow-lg">
            <h2 class="text-4xl font-bold text-blue-700 mb-8 text-center">履歷審核與 AI 摘要</h2>

            <!-- 新增設置面板 -->
            <div class="mb-8 bg-white p-6 rounded-xl shadow-lg">
              <h3 class="text-xl font-bold text-gray-800 mb-4">客製化設置</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-gray-700 font-medium mb-2">選擇產業</label>
                  <select
                    v-model="interviewSettings.industry"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="ind in industries" :key="ind.value" :value="ind.value">
                      {{ ind.label }}
                    </option>
                  </select>
                </div>
                <div>
                  <label class="block text-gray-700 font-medium mb-2">面試官角色</label>
                  <select
                    v-model="interviewSettings.role"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="role in roles" :key="role.value" :value="role.value">
                      {{ role.label }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <div class="mb-6 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition duration-300">
              <button
                @click="uploadFile"
                class="bg-blue-500 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-blue-600 transition duration-300 transform hover:scale-105"
              >
                選擇履歷檔案 (.txt 或 .pdf)
              </button>
              <p v-if="selectedFile" class="mt-3 text-gray-700">
                已選擇檔案: <span class="font-medium">{{ selectedFile.name }}</span>
              </p>
            </div>

            <button
              @click="simulateAISummary"
              :disabled="!selectedFile || isLoading"
              class="w-full bg-indigo-600 text-white px-6 py-3 rounded-full text-xl font-bold shadow-lg hover:bg-indigo-700 transition duration-300 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
            >
              <template v-if="isLoading">
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="[http://www.w3.org/2000/svg](http://www.w3.org/2000/svg)" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                AI 正在摘要中...
              </template>
              <template v-else>
                AI 摘要履歷
              </template>
            </button>

            <div v-if="aiSummary" class="mt-8 p-6 bg-blue-50 border-l-4 border-blue-400 rounded-lg shadow-inner">
              <h3 class="text-2xl font-bold text-blue-800 mb-4">模擬 AI 摘要結果</h3>
              <p class="text-gray-800 leading-relaxed whitespace-pre-wrap">{{ aiSummary }}</p>
              <p class="mt-4 text-sm text-gray-600 italic">
                （此為模擬 AI 摘要，實際應用需謹慎，請以您的判斷為準。）
              </p>
            </div>

            <!-- 面試設置面板 -->
            <div class="mb-8 bg-white p-6 rounded-xl shadow-lg">
              <h3 class="text-xl font-bold text-gray-800 mb-4">面試設置</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- 產業選擇 -->
                <div>
                  <label class="block text-gray-700 font-medium mb-2">產業</label>
                  <select
                    v-model="interviewSettings.industry"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="ind in industries" :key="ind.value" :value="ind.value">
                      {{ ind.label }}
                    </option>
                  </select>
                </div>

                <!-- 面試官角色 -->
                <div>
                  <label class="block text-gray-700 font-medium mb-2">面試官</label>
                  <select
                    v-model="interviewSettings.role"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="role in roles" :key="role.value" :value="role.value">
                      {{ role.label }}
                    </option>
                  </select>
                </div>

                <!-- 語言選擇 -->
                <div>
                  <label class="block text-gray-700 font-medium mb-2">語言</label>
                  <select
                    v-model="interviewSettings.language"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="lang in languages" :key="lang.value" :value="lang.value">
                      {{ lang.label }}
                    </option>
                  </select>
                </div>

                <!-- 難度選擇 -->
                <div>
                  <label class="block text-gray-700 font-medium mb-2">難度</label>
                  <select
                    v-model="interviewSettings.level"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                  >
                    <option v-for="level in levels" :key="level.value" :value="level.value">
                      {{ level.label }}
                    </option>
                  </select>
                </div>
              </div>
            </div>

            <!-- 面試問題練習區 -->
            <div class="mt-8 bg-white p-6 rounded-xl shadow-lg">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">模擬面試練習</h3>
                <button
                  @click="generateInterviewQuestions"
                  class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600"
                  :disabled="isLoading"
                >
                  {{ isLoading ? '生成中...' : '生成新問題' }}
                </button>
              </div>

              <div v-if="interviewQuestions.length > 0">
                <div class="mb-4">
                  <p class="text-lg font-medium">
                    問題 {{ currentQuestionIndex + 1 }}/{{ interviewQuestions.length }}:
                  </p>
                  <p class="text-xl text-gray-800 mt-2">
                    {{ interviewQuestions[currentQuestionIndex].question }}
                  </p>
                </div>

                <textarea
                  v-model="userAnswer"
                  class="w-full p-4 border rounded-lg h-32 mb-4"
                  :placeholder="'請用' + getLanguageLabel(interviewSettings.language) + '回答...'"
                ></textarea>
                <button
                  @click="evaluateAnswer"
                  :disabled="isAnalyzing"
                  class="w-full bg-green-600 text-white px-6 py-3 rounded-full text-lg font-semibold shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-105 flex items-center justify-center"
                >
                  <template v-if="isAnalyzing">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    評估中...
                  </template>
                  <template v-else>
                    提交回答評估
                  </template>
                </button>

                <!-- 評估結果顯示 -->
                <div v-if="feedbackResult" class="mt-4 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg shadow-inner">
                  <h4 class="text-lg font-semibold text-blue-800 mb-2">評估結果</h4>
                  <p class="text-gray-700 whitespace-pre-wrap">{{ feedbackResult }}</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `
    };

    // 在 Vue app 定義中添加 computed 屬性來處理頁面切換
    const app = Vue.createApp({
      data() {
        return {
          currentPage: 'landing',
          user: null,
          isAuthReady: false,
          showBookingSuccess: false
        }
      },
      computed: {
        getCurrentPage() {
          switch(this.currentPage) {
            case 'landing':
              return 'landing-page'
            case 'interview-essentials':
              return 'interview-essentials-page'
            case 'vocabulary-usage':
              return 'vocabulary-usage-page'
            case 'resume-review':
              return 'resume-review-page'
            default:
              return 'landing-page'
          }
        }
      },
      methods: {
        navigateToPage(pageName) {
          this.currentPage = pageName;
        },
        handleBookingSuccess() {
          this.showBookingSuccess = true;
          setTimeout(() => {
            this.showBookingSuccess = false;
          }, 3000);
        }
      },
      mounted() {
        // 確保頁面載入完成後再進行初始化
        this.isAuthReady = true;
        this.user = { uid: 'demo-user' };
      }
    });

    // 註冊所有組件
    app.component('landing-page', LandingPage);
    app.component('interview-essentials-page', InterviewEssentialsPage);
    app.component('vocabulary-usage-page', VocabularyUsagePage);
    app.component('resume-review-page', ResumeReviewPage);
    app.component('collapsible-section', CollapsibleSection);
    app.component('section-card', SectionCard);
    app.component('feature-card', FeatureCard);

    // 全局 mixin
    app.mixin({
      methods: {
        getLanguageLabel(value) {
          const languages = [
            { value: 'japanese', label: '日文' },
            { value: 'english', label: '英文' },
            { value: 'chinese', label: '中文' }
          ];
          return languages.find(l => l.value === value)?.label || value;
        },
        getLevelLabel(value) {
          const levels = [
            { value: 'beginner', label: '初級' },
            { value: 'intermediate', label: '中級' },
            { value: 'advanced', label: '高級' }
          ];
          return levels.find(l => l.value === value)?.label || value;
        },
        getIndustryLabel(value) {
          const industries = [
            { value: 'IT', label: 'IT/軟體開發' },
            { value: 'trading', label: '貿易/商社' },
            { value: 'manufacturing', label: '製造業' },
            { value: 'service', label: '服務業' }
          ];
          return industries.find(i => i.value === value)?.label || value;
        }
      }
    });

    // 掛載應用
    app.mount('#app');
  </script>

  <script>
// 表單提交追蹤
document.querySelector('form').addEventListener('submit', function(e) {
    gtag('event', 'form_submit', {
        'form_name': 'interview_tool'
    });
});

// 工具功能使用追蹤
document.querySelectorAll('.tool-feature').forEach(feature => {
    feature.addEventListener('click', function() {
        gtag('event', 'tool_feature_use', {
            'feature_name': this.getAttribute('data-feature')
        });
    });
});
</script>

<!-- Add Footer Section -->
<footer class="bg-gray-800 text-gray-300">
  <!-- 上半部：內容區 -->
  <div class="container mx-auto px-6 py-12 grid grid-cols-1 md:grid-cols-4 gap-8">
    <!-- 關於我們 -->
    <div>
      <h4 class="text-xl font-bold text-white mb-4">關於日文面試通</h4>
      <p class="text-sm leading-relaxed">
        提供最完整、最實用的日文面試準備資源，結合 AI 模擬與一對一指導，助您面試高分通過。
      </p>
    </div>

    <!-- 快速連結 -->
    <nav aria-label="Footer Links" class="space-y-2">
      <h4 class="text-xl font-bold text-white mb-4">快速連結</h4>
      <ul class="space-y-1 text-sm">
        <li><a href="#landing" class="hover:text-white">首頁</a></li>
        <li><a href="#interview-essentials" class="hover:text-white">面試精華</a></li>
        <li><a href="#vocabulary-usage" class="hover:text-white">敬語用具</a></li>
        <li><a href="#resume-review" class="hover:text-white">履歷審核</a></li>
        <li><a href="#contact" class="hover:text-white">聯絡我們</a></li>
      </ul>
    </nav>

    <!-- 訂閱電子報 -->
    <div>
      <h4 class="text-xl font-bold text-white mb-4">訂閱電子報</h4>
      <form class="flex flex-col sm:flex-row sm:items-center">
        <label for="footer-newsletter" class="sr-only">Email 地址</label>
        <input
          type="email"
          id="footer-newsletter"
          placeholder="輸入 Email"
          class="w-full sm:flex-grow px-4 py-2 mb-3 sm:mb-0 rounded-md bg-gray-700 border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <button
          type="submit"
          class="sm:ml-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-md text-white font-medium transition"
        >
          訂閱
        </button>
      </form>
      <p class="mt-3 text-xs text-gray-500">
        我們將定期推送最新面試技巧與資源，保證不會外洩您的信箱。
      </p>
    </div>

    <!-- 聯絡與社群 -->
    <div>
      <h4 class="text-xl font-bold text-white mb-4">聯絡我們</h4>
      <address class="not-italic text-sm space-y-2">
        <p>📍 台北市範本路123號</p>
        <p>📞 (02) 1234-5678</p>
        <p>✉️ service@example.com</p>
      </address>
    
      <div class="mt-4 flex space-x-3">
        <a href="#" aria-label="Facebook" class="hover:text-white">
          <svg class="w-6 h-6" /* 放上您的 SVG icon */></svg>
        </a>
        <a href="#" aria-label="LinkedIn" class="hover:text-white">
          <svg class="w-6 h-6"></svg>
        </a>
        <a href="#" aria-label="Instagram" class="hover:text-white">
          <svg class="w-6 h-6"></svg>
        </a>
      </div>
    </div>
  </div>

  <!-- 下半部：版權聲明 -->
  <div class="border-t border-gray-700">
  <div class="container mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center text-center text-sm text-gray-500">
    <div>
      © 2025 日文面試通。版權所有。<br class="md:hidden">建議使用 Chrome、Firefox 瀏覽器以獲得最佳體驗。
    </div>
    <div class="mt-2 md:mt-0">
      Powered by <a href="https://yourstudio.example.com" target="_blank" class="text-blue-400 hover:text-blue-300">數轉工作室</a>
    </div>
  </div>
</div>
</footer>
</body>
</html>